name: Deploy Presentation

on:
  push:
    branches: [ main ]
    paths:
      - 'docs/presentation.pptx.md'
      - '.github/workflows/deploy-presentation.yml'
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build:
    name: Build Marp Presentation
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        
    - name: Install Marp CLI
      run: |
        npm install -g @marp-team/marp-cli
        
    - name: Create output directory
      run: |
        mkdir -p public
        
    - name: Convert Marp to HTML
      run: |
        marp docs/presentation.pptx.md \
          --html \
          --allow-local-files \
          -o public/index.html
          
    - name: Convert Marp to PDF
      run: |
        marp docs/presentation.pptx.md \
          --pdf \
          --allow-local-files \
          -o public/presentation.pdf
      continue-on-error: true
        
    - name: Create index page
      run: |
        cat > public/README.md << 'EOF'
        # Embedded Portfolio Presentation
        
        ## ðŸŽ¯ í”„ë¡œì íŠ¸ í”„ë ˆì  í…Œì´ì…˜
        
        ### ì˜¨ë¼ì¸ í”„ë ˆì  í…Œì´ì…˜
        ðŸ‘‰ **[í”„ë ˆì  í…Œì´ì…˜ ë³´ê¸°](index.html)**
        
        ### ë‹¤ìš´ë¡œë“œ
        - ðŸ“„ [PDF ë‹¤ìš´ë¡œë“œ](presentation.pdf)
        
        ### ì†ŒìŠ¤ íŒŒì¼
        - ðŸ“ [Marp ì†ŒìŠ¤ íŒŒì¼](https://github.com/megaTRX/Embedded-Portfolio/blob/main/docs/presentation.pptx.md)
        
        ---
        
        ## ðŸ“Š í”„ë ˆì  í…Œì´ì…˜ ë‚´ìš©
        
        - í”„ë¡œì íŠ¸ ê°œìš”
        - í•µì‹¬ ê¸°ìˆ  ìŠ¤íƒ
        - ì£¼ìš” ê¸°ëŠ¥
        - í…ŒìŠ¤íŠ¸ ë°©ë²•ë¡ 
        - í”„ë¡œì íŠ¸ ì„±ê³¼
        
        ## ðŸš€ ì‚¬ìš© ë°©ë²•
        
        ### ì˜¨ë¼ì¸ì—ì„œ ë³´ê¸°
        1. ìœ„ì˜ "í”„ë ˆì íŠ¸ ë³´ê¸°" ë§í¬ í´ë¦­
        2. í‚¤ë³´ë“œ í™”ì‚´í‘œ ë˜ëŠ” í´ë¦­ìœ¼ë¡œ ìŠ¬ë¼ì´ë“œ ì´ë™
        
        ### ë°œí‘œ ëª¨ë“œ
        - `F` í‚¤: ì „ì²´ í™”ë©´
        - `P` í‚¤: ë°œí‘œìž ë…¸íŠ¸ (ìžˆëŠ” ê²½ìš°)
        - `â†’` / `â†`: ë‹¤ìŒ/ì´ì „ ìŠ¬ë¼ì´ë“œ
        
        ---
        
        **Generated by Marp** | [GitHub Repository](https://github.com/megaTRX/Embedded-Portfolio)
        EOF
        
    - name: Setup Pages
      uses: actions/configure-pages@v4
      
    - name: Upload artifact
      uses: actions/upload-pages-artifact@v3
      with:
        path: 'public'
        
  deploy:
    name: Deploy to GitHub Pages
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    
    steps:
    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4
