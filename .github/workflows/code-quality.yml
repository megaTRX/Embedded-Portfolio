name: Code Quality

on:
  push:
    branches: [ main, develop ]
    paths:
      - 'src/**'
      - 'inc/**'
  pull_request:
    branches: [ main, develop ]

jobs:
  # Ï†ïÏ†Å Î∂ÑÏÑù
  static-analysis:
    name: Static Code Analysis
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Install Cppcheck
      run: |
        sudo apt-get update
        sudo apt-get install -y cppcheck
        
    - name: Run Cppcheck
      run: |
        if [ -d src ]; then
          echo "Running Cppcheck on source files..."
          cppcheck --enable=all --inconclusive --xml --xml-version=2 src/ 2> cppcheck-report.xml || echo "No source files yet"
          cppcheck --enable=all --inconclusive src/ || echo "No source files yet"
        else
          echo "Source directory not created yet"
        fi
      continue-on-error: true
        
    - name: Upload Cppcheck results
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: cppcheck-report
        path: cppcheck-report.xml
      continue-on-error: true
        
  # ÏΩîÎìú Ìè¨Îß∑ Í≤ÄÏÇ¨
  format-check:
    name: Code Format Check
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Install clang-format
      run: |
        sudo apt-get update
        sudo apt-get install -y clang-format
        
    - name: Check code formatting
      run: |
        if [ -d src ]; then
          echo "Checking code formatting..."
          find src -name "*.c" -o -name "*.h" | xargs clang-format --dry-run --Werror || echo "Format check pending"
        else
          echo "No source files to check yet"
        fi
      continue-on-error: true
        
  # Î≥µÏû°ÎèÑ Î∂ÑÏÑù
  complexity-analysis:
    name: Code Complexity Analysis
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Install lizard
      run: |
        pip install lizard
        
    - name: Run complexity analysis
      run: |
        if [ -d src ]; then
          echo "Analyzing code complexity..."
          lizard src/ -l c || echo "No source files yet"
        else
          echo "Source directory not created yet"
        fi
      continue-on-error: true
        
  # ÏΩîÎìú Î©îÌä∏Î¶≠Ïä§
  code-metrics:
    name: Code Metrics
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Count lines of code
      run: |
        echo "üìä Code Metrics"
        echo "=============="
        echo ""
        if [ -d src ]; then
          echo "Source files:"
          find src -name "*.c" | wc -l || echo "0"
          echo ""
          echo "Header files:"
          find inc -name "*.h" | wc -l || echo "0"
          echo ""
          echo "Total lines:"
          find src inc -name "*.c" -o -name "*.h" | xargs cat | wc -l || echo "0"
        else
          echo "No source code yet - project in documentation phase"
        fi
